<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="=IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--以上几个是必须的-->
    <meta name="description" content="hello">
    <meta name="author" content="test">
    <title>礼金录入</title>

    <!--inport bootstrap-->
    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <link href="bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script type="text/javascript" src="bootstrap-3.3.7/js/bootstrap.min.js"></script>

    <!-- bootstrap-table-1.12.1 start  -->
    <link rel="stylesheet" href="bootstrap-table-1.12.1/dist/bootstrap-table.css">
    <link rel="stylesheet" href="css/bootstrap-editable.css">
    <script type="text/javascript" src="bootstrap-table-1.12.1/dist/bootstrap-table.js"></script>
    <script type="text/javascript" src="bootstrap-table-1.12.1/dist/bootstrap-table-locale-all.js"></script>
    <script type="text/javascript" src="bootstrap-table-1.12.1/docs/dist/extensions/editable/bootstrap-table-editable.js"></script>
    <script src="js/bootstrap-editable.js"></script>
    <script src="bootstrap-table-1.12.1/src/extensions/export/bootstrap-table-export.js"></script>
    <script src="js/tableExport.js"></script>


    <!-- bootstrap-table-1.12.1 end  -->

    <!-- Custom styles for this template -->
    <link href="signin.css" rel="stylesheet">



</head>

<body style="background-color: #444141">

    <div class="container" style="background-color: #fbff00">
        <div class="container">

            <div class="form-signin" name="holder_form">
                <h2 class="form-signin-heading" align="center">主家信息</h2>
                <input type="text" id="Ffull_name" name="Ffull_name" class="form-control" placeholder="主家姓名" required autofocus>
                <input type="text" id="Faddr" name="Faddr" class="form-control" placeholder="来自哪里" required autofocus>
                <input type="text" id="Fmoney" name="Fmoney" class="form-control" placeholder="主家金额" required>
                <button id="hold_btn" class="btn btn-lg btn-primary btn-block" type="submit">确定</button>
                <button disabled id="hold_edit_btn" class="btn btn-lg btn-primary btn-block" type="submit">修改</button>
            </div>
        </div>

        <hr />

        <div class="container">

            <div class="form-signin">
                <h2 class="form-signin-heading" align="center">跟来人信息</h2>
                <input type="text" id="follower_name" class="form-control" placeholder="姓名" required autofocus>
                <input type="text" id="follower_money" class="form-control" placeholder="金额" required>
                <button disabled id="follower_btn" class="btn btn-lg btn-primary btn-block" type="submit">确定</button>
            </div>

        </div>

        <hr />

        <div class="container">
            <table id="table">

            </table>
            <button class="btn-warning">确认提交</button>
        </div>


    </div>
    <script>
        var $table = $('#table'),
            $hold_btn = $('#hold_btn'),
            $hold_edit_btn = $('#hold_edit_btn'),
            $follower_btn = $('#follower_btn'),
            rows = [],
            datas = [],
            id = 1,
            host_name = "",
            addr = "",
            selections = [];

        function initTable() {
            $table.bootstrapTable({
                //height: getHeight(),
                //url: 'dataj.json',
                method: 'get',
                //                dataType: "json",
                //              data_locale: 'zh-CN',
                undefinedText: "暂无数据", //当数据为 undefined 时显示的字符
                //                search: true,
                showRefresh: true,
                showColumns: true,
                mininumCountColumns: 2,
                showExport: true,

                columns: [
                    [{
                        title: "测试以下标题栏",
                        colspan: 4,
                        align: 'center'
                    }],
                    [{
                        title: "序号",
                        field: 'id',
                        align: 'center',
                        valign: 'midddle',
                        sortable: true,
                    }, {
                        title: "姓名",
                        field: 'full_name',
                        align: 'center',
                        valign: 'midddle',
                        editable: true
                    }, {
                        title: "金额",
                        field: 'money',
                        align: 'center',
                        valign: 'midddle',
                        sortable: true,
                        editable: true
                    }, {
                        field: 'operation',
                        title: '操作',
                        align: 'center',
                        events: operateEvents, //给按钮注册事件  
                        formatter: addFunctionAlty //表格中增加按钮</span>  
                    }]
                ]
            });

            $hold_btn.click(function() {
                var row = [];
                var per = {
                    "id": id,
                    "full_name": $("#Ffull_name").val(),
                    "money": $("#Fmoney").val()
                }

                var d = new Date();
                var dateStr = d.getFullYear() + "-" + d.getMonth() + "-" + d.getDay() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
                host_name = $("#Ffull_name").val();
                addr = $("#Faddr").val();
                var data = {
                    "name": $("#Ffull_name").val(),
                    "host_name": host_name,
                    "addr": addr,
                    "money": $("#Fmoney").val(),
                    "mark_datetime": dateStr
                };
                datas.push(data);
                console.log(datas)

                row.push(per);
                rows.push(per);
                console.log(JSON.stringify(rows));

                $("#table").bootstrapTable('append', row);
                //alert("test!")
                id = id + 1;
                $follower_btn.attr("disabled", false);
                $hold_btn.attr("disabled", true);
                $hold_edit_btn.attr("disabled", false);

            });

            $hold_edit_btn.click(function() {
                host_name = $("#Ffull_name").val();
                addr = $("#Faddr").val();

            });

            $follower_btn.click(function() {
                var row = [];
                var per = {
                    "id": id,
                    "full_name": $("#follower_name").val(),
                    "money": $("#follower_money").val()
                }
                var d = new Date();
                var dateStr = d.getFullYear() + "-" + d.getMonth() + "-" + d.getDay() + " " + d.getHours() + ":" + d.getMinutes() + ":" + d.getSeconds();
                var data = {
                    "name": $("#follower_name").val(),
                    "host_name": host_name,
                    "addr": addr,
                    "money": $("#follower_money").val(),
                    "mark_datetime": dateStr
                };
                datas.push(data);
                console.log(datas);

                row.push(per);
                rows.push(per);
                console.log(JSON.stringify(rows));

                $("#table").bootstrapTable('append', row);
                id = id + 1;
                //alert("test!")

            });
        }
        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        // 修改按钮、删除按钮
        function addFunctionAlty(value, row, index) {
            return [
                '<a style="color:red" class="remove" id="btn_delete" href="javascript:void(0)" title="删除">',
                '<i class="glyphicon glyphicon-remove"></i>',
                '</a>'
            ].join('');
        }

        window.operateEvents = {
            // 点击删除按钮执行的方法  
            'click #btn_delete': function(e, value, row, index) {
                // 写自己的方法。。。  
            }
        };

        ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        $(function() {
            var scripts = [
                    location.search.substring(1) || 'bootstrap-table-1.12.1/src/bootstrap-table.js',
                    'bootstrap-table-1.12.1/src/extensions/export/bootstrap-table-export.js',
                    'bootstrap-table-1.12.1/src/extensions/editable/bootstrap-table-editable.js',

                ],
                eachSeries = function(arr, iterator, callback) {
                    callback = callback || function() {};
                    if (!arr.length) {
                        return callback();
                    }
                    var completed = 0;
                    var iterate = function() {
                        iterator(arr[completed], function(err) {
                            if (err) {
                                callback(err);
                                callback = function() {};
                            } else {
                                completed += 1;
                                if (completed >= arr.length) {
                                    callback(null);
                                } else {
                                    iterate();
                                }
                            }
                        });
                    };
                    iterate();
                };
            eachSeries(scripts, getScript, initTable);
        });

        function getScript(url, callback) {
            var head = document.getElementsByTagName('head')[0];
            var script = document.createElement('script');
            script.src = url;
            var done = false;
            // Attach handlers for all browsers
            script.onload = script.onreadystatechange = function() {
                if (!done && (!this.readyState ||
                        this.readyState == 'loaded' || this.readyState == 'complete')) {
                    done = true;
                    if (callback)
                        callback();
                    // Handle memory leak in IE
                    script.onload = script.onreadystatechange = null;
                }
            };
            head.appendChild(script);
            // We handle everything using the script element injection
            return undefined;
        }
    </script>
</body>

</html>